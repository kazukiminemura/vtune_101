# Microarchitecture Exploration
マイクロアーキテクチャ探索は、典型的なクライアントアプリケーションを分析するためのイベントの完全なリストを収集します。  
それにより、指標に使用される一連の事前定義された比率を計算し、ハードウェアレベルのパフォーマンス問題を特定するのに役立ちます。  

## 動作原理
コード名 Ivy Bridge 以降の最新のマイクロアーキテクチャでは、マイクロアーキテクチャ探索分析は、アプリケーション内の主要なパフォーマンスボトルネックを特定するイベントベースの指標の階層的な組織である Top-Down Characterization 方法論を使用した Top-Down Microarchitecture Analysis Method に基づいています。

## パイプラインスロット分析
各サイクルで、各コアは最大4つのパイプラインスロットを有用な操作で埋めることができます。そのため、特定の時間間隔で、その間に埋められ発行された可能性のあるパイプラインスロットの最大数を決定することが可能です。この分析では、その推定を行い、すべてのパイプラインスロットを以下の4つのカテゴリに分類します：

- 発行されリタイアされた有用な作業を含むパイプラインスロット（リタイア済み: Retired）

- 発行されたがキャンセルされた有用な作業を含むパイプラインスロット（誤推測: Bad speculation）

- フロントエンドの問題により有用な作業で埋めることができなかったパイプラインスロット（フロントエンドボトルネック: Front-end Bound）

- バックエンドの遅延により有用な作業で埋めることができなかったパイプラインスロット（バックエンドボトルネック: Back-end Bound）


## 使用方法
```
ONEAPI_DEVICE_SELECTOR=opencl:cpu vtune --collect uarch-exploration -- ./a.out
```
## GUI例
### Summary
![image](https://github.com/user-attachments/assets/95d51232-f1a1-4805-a66b-71684863b6c4)
各指標は、Intel のアーキテクトによって定義されたイベント比率であり、それぞれに事前定義された閾値があります。VTune Profiler は、各集約されたプログラム単位（例えば、関数）に対する比率値を分析します。この値が閾値を超え、さらにそのプログラム単位が収集された CPU 時間の 5%以上の CPU 時間を持つ場合、それは潜在的なパフォーマンス問題を示唆し、そのような値をピンクで強調表示します。


### Bottom-up
![image](https://github.com/user-attachments/assets/f618f157-f6c2-4098-92ca-04153f97f025)

プログラムユニットごとのハードウェア問題を確認するには、Bottom-up ペインに切り替えます。各行はプログラムユニットとそのユニットが使用した時間の割合を表します。CPU 時間の 5%以上を占めるプログラムユニットはホットスポットと見なされます。デフォルトでは、VTune Profiler はデータを Clockticks に基づいて降順にソートし、ホットスポットをリストの上部に表示します。

Bottom-up ペインのほとんどの列は、ハードウェアパフォーマンス指標を表します。VTune Profiler は、Intel のアーキテクトによって提供された式に基づいて指標を計算します。列のヘッダーにカーソルを合わせると、指標の説明を読むことができます。デフォルトでは、指標値は数値として表示されますが、コンテキストメニューの「Show Data As」オプションを使用して表示モードを変更できます。

右ペインには、選択した関数のコンテキストサマリーが表示されます。関数ごとのハードウェア指標を分析し、それらの µPipe 図上での視覚的な表現を確認することで、その特定の関数が全体のパフォーマンスに与える影響を評価できます。

各指標には閾値があります。指標値が閾値を超え、かつそのプログラムユニットがホットスポットである場合、VTune Profiler はその値をピンクで強調表示し、パフォーマンスクリティカルであることを示します。ピンクのセルにカーソルを合わせることで、問題の説明や（ある場合は）推奨される解決策を読むことができます。

